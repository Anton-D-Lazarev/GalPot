###############################################################################
#   Makefile for the GalPot library, cut away from all extraneous everything  #
#                                                                             #
#  Copyright Walter Dehnen, 1996-2005                                         #
#  address:  Department of Physics and Astronomy, University of Leicester     #
#           University Road, Leicester LE1 7RH, United Kingdom                #
#                                                                             #
#                                                                             #
###############################################################################

all: testGalPot obj/PJMCoords obj/OrbitIntegrator


CPP		= g++
LIBPOT		= obj/libPot.a

CFLAGS        = -c -o $@.o -O3 -ffast-math -Isrc/
CFLAGSKEEP    = -c -o $@ -O3 -ffast-math -Isrc/

CMPFLAGS        = -c -o $@.o -O3 -ffast-math -fopenmp -Isrc/

MFLAGS	= -O3 -ffast-math -Isrc/

LDFLAGS      = -o $@ -Lobj/ -lPot  -lm

# commands to put file into library
AR            = ar r
RL            = ranlib

ARPOT     = $(AR) $(LIBPOT) $@.o; $(RL) $(LIBPOT); touch $@
AWAY	  = rm $@.o

AUXIL_H		   = src/Pi.h src/Inline.h src/FreeMemory.h src/Vector.h \
		     src/Matrix.h src/Numerics.templates src/Numerics.h \
		     src/Pspline.h 

GalPot_h	   = src/GalPot.h src/Potential.h

obj/Numerics:		src/Numerics.cc $(AUXIL_H)
			$(CPP) $(CFLAGS) src/Numerics.cc;$(ARPOT);$(AWAY)
obj/WDMath:		src/WDMath.cc $(AUXIL_H)
			$(CPP) $(CFLAGS) src/WDMath.cc;$(ARPOT);$(AWAY)

obj/GalPot: 		src/GalPot.cc $(GalPot_h) $(AUXIL_H)
	      		$(CPP) $(CFLAGS) src/GalPot.cc;$(ARPOT);$(AWAY)

GalPot: 		obj/Numerics obj/WDMath obj/GalPot


obj/testGalPot:		testGalPot.cc GalPot
			$(CPP) $(CFLAGS) testGalPot.cc;  touch $@
testGalPot:		obj/testGalPot GalPot
			$(CPP) obj/testGalPot.o $(LDFLAGS)

obj/OrbitIntegrator: src/OrbitIntegrator.cc src/OrbitIntegrator.h $(GalPot_h) $(AUXIL_H)
		     $(CPP) $(CFLAGS) src/OrbitIntegrator.cc

obj/PJMCoords:	src/PJMCoords.cc src/PJMCoords.h src/Pi.h
	$(CPP) $(CFLAGS) $<

#findOrbitProperties:	findOrbitProperties.cc GalPot obj/OrbitIntegrator
#		$(CPP) $(MFLAGS) -o $@.exe $<  obj/OrbitIntegrator.o -Lobj -lPot -lm


%.exe:	%.cc GalPot obj/OrbitIntegrator obj/PJMCoords
	$(CPP) $(MFLAGS) -o $@ $<  obj/OrbitIntegrator.o obj/PJMCoords.o -Lobj -lPot -lm

clean:
	rm -f obj/* testGalPot
